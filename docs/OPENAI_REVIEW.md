# OpenAI Code Review — 2026-02-18 13:03

**Model:** gpt-5.2-codex
**Risk Score:** 7/10
**Summary:** CF 결과와 코드 흐름을 보면 VPIN 필터와 비용 이중차감 문제를 해결하면 기대손실을 크게 줄일 여지가 있으며, 현재 레버리지/사이징 설정은 변동 구간에서 과도한 리스크를 내포합니다.

## Suggestions

### [P1] VPIN 상한을 0.3으로 낮춰 adverse selection 차단
**Category:** param | **Confidence:** 73%

CF 분석에서 vpin_filter(max_vpin=0.3)가 OOS PnL +$276로 가장 큰 개선치를 보였습니다. 현재 CHOP_VPIN_MAX=0.65, UNI_MAX_VPIN_HARD=0.95로 느슨하여 고 VPIN 구간에서 손실이 누적될 가능성이 큽니다. 전 레짐 공통으로 VPIN 상한을 0.3으로 낮추는 것이 합리적입니다.

**Env Changes:** `{'CHOP_VPIN_MAX': '0.3', 'UNI_MAX_VPIN_HARD': '0.3', 'LEVERAGE_HIGH_QUALITY_MAX_VPIN': '0.3'}`

**Code Changes:** 없음 (환경변수 적용만 필요)

**Expected Impact:** 고 VPIN(독성 유동성) 구간 진입 감소로 손실 트레이드 감소, OOS 기준 PnL +$200~$280 기대

### [P1] net_expectancy 필터의 수수료 이중 차감 제거
**Category:** logic | **Confidence:** 68%

문서에 명시된 대로 net_expectancy 계산에서 MC EV(이미 fee 포함)에서 다시 fee_est를 차감해 실제 EV가 과도하게 낮아집니다. 이중 차감은 특히 짧은 horizon에서 both_ev_neg 차단을 과도하게 발생시키며, 진입 기회 손실로 이어집니다. MC EV를 그대로 쓰거나 fee_est를 0으로 두어 한 번만 비용을 반영하도록 수정해야 합니다.

**Code Changes:** main_engine(또는 entry filter 구현부)의 _min_filter_states()에서 `net_edge = edge_raw - fee_est`를 `net_edge = edge_raw`로 변경하거나, fee_est를 MC 비용으로 대체. 관련 주석/테스트 업데이트.

**Expected Impact:** 불필요한 차단 감소, EV/score 정합성 개선, 거래 수 회복

### [P2] seed 결정에 안정적 해시 사용
**Category:** logic | **Confidence:** 83%

decision.py에서 `hash(symbol)`은 프로세스마다 seed가 바뀌는 Python hash randomization의 영향을 받습니다. 백테스트/리플레이 재현성에 문제가 생길 수 있으므로 안정적 해시(xxhash, md5 등)를 사용해 seed를 고정해야 합니다.

**Code Changes:** engines/mc/decision.py: `hash(symbol)` 대신 `int(hashlib.md5(symbol.encode()).hexdigest()[:8],16)` 또는 xxhash 사용.

**Expected Impact:** 실험 재현성 향상, 디버깅/CF 결과 안정화

### [P2] 저신뢰 구간에서 레버리지 하한 강제 해제(동적 floor)
**Category:** risk | **Confidence:** 61%

ENV에 UNI_LEV_MIN=10이 설정되어 있으나, low_conf/vpin_high 상황에서는 레버리지 1x 이하가 더 안전합니다. 현재 코드 흐름이 최소레버리지 우선 적용이면 저신뢰 구간에서도 과도한 레버리지가 유지될 수 있습니다. low_conf 또는 high_vpin일 때는 min leverage를 1~2로 강제하는 분기 로직이 필요합니다.

**Env Changes:** `{'LEVERAGE_LOW_CONF_CAP': '1.0', 'LEVERAGE_HIGH_VPIN_CAP': '1.0'}`

**Code Changes:** engines/mc/decision.py: 최종 레버리지 결정 전에 `if dir_conf < threshold or vpin > threshold: lev_floor = 1.0` 적용. 최소레버리지 적용 순서를 저신뢰/고 VPIN 캡 이후로 이동.

**Expected Impact:** 급변/저신뢰 구간의 손실 tail risk 감소, 강제 청산 위험 완화

## Warnings
- 현재 bybit.env에서 HYBRID_SIZE_FRAC=1.0, UNI_LEV_MAX=50 등 매우 공격적 노출이 설정되어 있어 급격한 변동성 상승 시 계좌 손실 위험이 큽니다.
- Python hash 기반 seed는 프로세스마다 달라져 백테스트/리플레이 결과가 흔들릴 수 있습니다.


---
*Auto-generated by research/openai_reviewer.py*