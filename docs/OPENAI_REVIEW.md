# OpenAI Code Review — 2026-02-18 03:40

**Model:** gpt-4.1-mini
**Risk Score:** 7/10
**Summary:** 전략 코드는 MonteCarlo 기반의 하이브리드 unified 진입/청산 로직을 구현하며, 레짐별 정책과 환경변수 기반 파라미터 튜닝이 잘 구성되어 있으나, 일부 비용 이중 차감, 복잡한 감쇠 체인, 레버리지 및 포지션 사이징 관련 리스크 관리 개선 여지가 존재합니다.

## Suggestions

### [P1] EV 계산 시 비용 이중 차감 문제 해결
**Category:** logic | **Confidence:** 90%

evaluate_entry_metrics() 및 _min_filter_states()에서 MC 시뮬레이션 결과 EV에 이미 비용이 포함되어 있으나, 필터링 단계에서 다시 비용을 차감하여 net_edge가 과도하게 감소하는 현상이 있음. 이는 진입 필터가 과도하게 보수적으로 작동해 기회 손실을 초래할 수 있음. 비용 차감 로직을 명확히 분리하거나, net_expectancy 필터에서 비용 차감 부분을 제거하거나 조정해야 함.

**Env Changes:** `{'ENTRY_NET_EXPECTANCY_MIN': '-0.0008'}`

**Code Changes:** engines/mc/entry_evaluation.py 내 evaluate_entry_metrics()에서 fee_est 차감 부분 검토 및 중복 비용 차감 제거, 관련 필터링 로직 수정 필요.

**Expected Impact:** EV 필터링의 과도한 보수성 완화로 진입 기회 증가 및 수익성 개선 기대.

### [P1] bybit.env 내 Volatility Gate 및 Chop Guard 파라미터 반영 및 최적화
**Category:** param | **Confidence:** 85%

CF 분석 결과에 따른 chop_min_sigma=0.1, chop_max_sigma=2.5, chop_min_dir_conf=0.64, chop_min_abs_mu_alpha=5.0, chop_max_hold_sec=180 등의 파라미터가 수익성 개선에 유의미함. 현재 설정과 비교해 차이가 있으므로, 해당 파라미터를 환경변수에 명확히 반영하고, chop_entry_floor_add, chop_entry_min_dir_conf 등도 CF 권고값에 맞춰 조정할 필요가 있음.

**Env Changes:** `{'CHOP_MIN_SIGMA': '0.1', 'CHOP_MAX_SIGMA': '2.5', 'CHOP_MIN_DIR_CONF': '0.64', 'CHOP_MIN_ABS_MU_ALPHA': '5.0', 'CHOP_MAX_HOLD_SEC': '180', 'CHOP_ENTRY_FLOOR_ADD': '0.003', 'CHOP_ENTRY_MIN_DIR_CONF': '0.8'}`

**Code Changes:** state/bybit.env 및 engines/mc/regime_policy.py 내 기본값 및 env 변수 매핑 부분 업데이트.

**Expected Impact:** 변동성 및 방향성 필터링 강화로 불필요한 진입 차단 감소 및 수익성 향상.

### [P2] 레버리지 하한 및 상한 정책 개선 및 리스크 완화
**Category:** risk | **Confidence:** 80%

현재 UNI_LEV_MIN=10.0으로 하한이 매우 높아, 낮은 신뢰도 구간에서 과도한 레버리지 사용 위험 존재. CF 결과에 따르면 2~10 구간이 최대 손실 구간으로, 최소 레버리지를 1~5 수준으로 낮추고, regime별 상한도 보다 보수적으로 설정하는 것이 권장됨. 또한, 레버리지 결정 로직에 신뢰도 및 변동성 기반 동적 조절 강화 필요.

**Env Changes:** `{'UNI_LEV_MIN': '1.0', 'UNI_LEV_MAX_CHOP': '10', 'UNI_LEV_MAX_VOLATILE': '8', 'UNI_LEV_MAX_BEAR': '15'}`

**Code Changes:** engines/mc/decision.py 내 레버리지 산출 및 smoothing 로직에 신뢰도 기반 캡핑 강화 및 하한 완화 적용.

**Expected Impact:** 과도한 레버리지 리스크 감소 및 손실 제한, 안정적 수익성 확보.

### [P2] 하이브리드 unified 진입/청산 로직 내 방향 결정 및 점수 산출 개선
**Category:** logic | **Confidence:** 75%

현재 방향 결정에 mu_alpha 부호와 consensus 모델 혼용, 그리고 policy_score 산출 시 방향과 무관한 점수 사용 이력이 있음. 코드 내 주석에 따라 방향과 일치하는 score 사용으로 수정되었으나, batch 처리 및 fallback 로직에서 일관성 유지 및 예외 처리 강화 필요. 또한, 방향 결정 시 confidence gate 및 edge gap 조건을 엄격히 적용하여 false signal 최소화 권장.

**Code Changes:** engines/mc/decision.py 내 _decide_hybrid_only() 및 batch 처리 로직에서 방향 결정 및 score 산출 부분 리팩토링 및 예외 처리 강화.

**Expected Impact:** 방향성 신뢰도 향상으로 잘못된 진입 감소 및 수익성 개선.

### [P3] 메모리 누수 및 대형 배열 명시적 해제 강화
**Category:** perf | **Confidence:** 70%

evaluate_entry_metrics() 등에서 대형 텐서 및 배열 해제를 명시적으로 수행하고 있으나, 일부 예외 상황에서 누락 가능성 존재. 특히 GPU 메모리 캐시 정리 및 Python GC 호출을 주기적으로 강제하여 메모리 사용량 안정화 필요. 또한, batch 처리 시 불필요한 복사본 생성 최소화 및 numpy 변환 최적화 권장.

**Code Changes:** engines/mc/entry_evaluation.py 및 engines/mc/decision.py 내 메모리 해제 및 캐시 정리 코드 강화, 불필요한 복사 제거.

**Expected Impact:** 메모리 사용량 감소 및 장시간 운용 시 안정성 향상.

### [P3] TP/SL 및 최대 보유 시간 재조정
**Category:** param | **Confidence:** 75%

현재 bybit.env 내 POLICY_MAX_HOLD_SEC=1800(30분)으로 설정되어 있으나, CF 결과 장기 보유 시 손실 누적이 확인됨. TP/SL 밴드도 장기 보유에 맞춰 넓게 설정되어 있어, 단기 중심 전략에 맞게 TP/SL 및 최대 보유 시간을 보다 엄격히 조정할 필요가 있음.

**Env Changes:** `{'POLICY_MAX_HOLD_SEC': '900', 'DEFAULT_TP_PCT': '0.025', 'DEFAULT_SL_PCT': '0.015'}`

**Code Changes:** engines/mc/regime_policy.py 내 기본 TP/SL 및 max_hold_sec 파라미터 조정.

**Expected Impact:** 과도한 장기 보유 리스크 감소 및 손실 제한.

## Warnings
- MC EV 계산 시 비용이 이미 포함되어 있으므로, 추가 비용 차감 시 이중 차감으로 인한 과도한 보수성 발생 가능.
- 하이브리드 unified 로직은 복잡하며, 방향 결정 및 점수 산출 시 일관성 유지가 매우 중요함.
- 레버리지 하한이 너무 높으면 낮은 신뢰도 구간에서 과도한 위험 노출 가능.
- 환경변수 변경 시 전체 파이프라인 영향도를 충분히 테스트해야 함.
- 메모리 해제 및 캐시 정리 미흡 시 장시간 운용 중 메모리 누수 및 성능 저하 우려.


---
*Auto-generated by research/openai_reviewer.py*