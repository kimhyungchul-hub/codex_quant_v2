# OpenAI Code Review — 2026-02-18 03:55

**Model:** gpt-4.1-mini
**Risk Score:** 7/10
**Summary:** 전략 코드는 MC 기반 EV 산출과 하이브리드 진입/청산 로직을 통합하여 방향성과 레버리지 최적화를 수행하며, 환경변수 기반 파라미터 조정과 리스크 관리가 체계적이다. 다만, fee 관련 이중 차감 문제와 일부 파라미터의 비효율적 설정, 그리고 메모리 관리 및 성능 최적화 여지가 존재한다.

## Suggestions

### [P1] Fee 이중 차감 문제 해결 및 필터 과차단 완화
**Category:** logic|risk | **Confidence:** 90%

현재 MC EV 계산에서 이미 수수료가 포함된 상태에서 entry net expectancy 필터에서 다시 fee를 차감하여 실제 EV가 과도하게 낮아지는 이중 차감 문제가 있음. 이로 인해 진입 후보가 과도하게 차단되고 수익 기회가 감소할 수 있음. 해결책으로는 entry net expectancy 필터에서 fee 차감 부분을 제거하거나, MC EV에서 fee를 역산해 보정하는 방식을 적용해야 함.

**Env Changes:** `{'ENTRY_NET_EXPECTANCY_MIN': '-0.0008'}`

**Code Changes:** engines/mc/entry_evaluation.py 내 _min_filter_states() 함수에서 net_edge 계산 시 fee_est 차감 부분을 주석 처리하거나 제거. 또는 MC EV 계산부에서 fee를 제외한 순수 EV 값을 별도로 제공하도록 수정.

**Expected Impact:** 필터 과차단 완화로 진입 후보가 증가하고, 수익 기회 확대 및 PnL 개선 기대.

### [P1] Bybit.env 내 fee 관련 파라미터 및 entry threshold 조정
**Category:** param|risk | **Confidence:** 80%

최근 CF 결과와 환경변수 설정을 고려할 때, fee 추정치와 entry threshold가 너무 보수적이거나 비현실적으로 설정되어 있음. 특히 CHOP_ENTRY_FLOOR_ADD, CHOP_ENTRY_MIN_DIR_CONF, chop_min_abs_mu_alpha 등의 값이 진입을 과도하게 제한함. fee 관련 변수(예: HYBRID_BASE_FEE_RATE, HYBRID_SLIPPAGE_BPS)도 실제 시장 비용과 맞추어 재조정 필요.

**Env Changes:** `{'CHOP_ENTRY_FLOOR_ADD': '0.0015', 'CHOP_ENTRY_MIN_DIR_CONF': '0.64', 'CHOP_MIN_ABS_MU_ALPHA': '3.0', 'HYBRID_BASE_FEE_RATE': '0.00015', 'HYBRID_SLIPPAGE_BPS': '10'}`

**Code Changes:** state/bybit.env 파일에서 위 변수 값 조정 및 테스트. 필요 시 config.py에서 기본값도 동기화.

**Expected Impact:** 진입 필터 완화로 후보군 확대, 과도한 차단 감소 및 수익률 향상 기대.

### [P2] 메모리 누수 및 GPU 캐시 정리 강화
**Category:** perf|risk | **Confidence:** 70%

evaluate_entry_metrics 함수 내 대형 배열 및 텐서 해제 후 가비지 컬렉션과 GPU 캐시 정리를 수행하고 있으나, 일부 예외 처리 및 명시적 해제가 누락될 수 있음. 특히 PyTorch MPS/CUDA 캐시 정리 부분을 try-except로 감싸고 있으나, 캐시 정리 호출 시점과 빈도를 최적화할 필요가 있음.

**Code Changes:** engines/mc/entry_evaluation.py 내 메모리 정리 블록을 주기적으로 호출하도록 개선, GPU 캐시 정리 함수 분리 및 명확한 호출 타이밍 설정.

**Expected Impact:** 메모리 사용량 안정화 및 장기 운용 시 메모리 누수 감소, 성능 저하 방지.

### [P2] 하이브리드 진입/청산 로직의 환경변수 의존성 명확화 및 기본값 검토
**Category:** logic|param | **Confidence:** 75%

MC_HYBRID_ONLY, MC_USE_HYBRID_PLANNER, USE_DIRECTION_MODEL 등 하이브리드 관련 플래그가 환경변수와 config 간 중복 및 불명확한 우선순위를 가짐. 기본값과 환경변수 우선순위 로직을 명확히 하여 예기치 않은 동작 방지 필요.

**Code Changes:** engines/mc/decision.py 및 engines/mc/config.py 내 하이브리드 관련 플래그 초기화 로직 정리 및 주석 보강.

**Expected Impact:** 환경변수 변경 시 의도한 대로 전략 동작 보장 및 디버깅 용이성 향상.

### [P3] 레짐별 최대 레버리지 및 포지션 사이징 제한 강화
**Category:** param|risk | **Confidence:** 70%

현재 UNI_LEV_MAX, max_leverage 등이 30~50 수준으로 높게 설정되어 있어 급격한 손실 위험 존재. CF 결과를 참고하여 레짐별로 보수적인 최대 레버리지(예: chop 6~8, bear 10~12)와 포지션 최대 비중 제한을 강화할 필요가 있음.

**Env Changes:** `{'UNI_LEV_MAX_CHOP': '8', 'UNI_LEV_MAX_BEAR': '12', 'UNI_MAX_POS_FRAC': '0.25'}`

**Code Changes:** state/bybit.env 내 관련 변수 조정 및 regime_policy.py 내 기본값 동기화 검토.

**Expected Impact:** 과도한 레버리지 진입 감소로 손실 리스크 완화, 안정적 수익 추구 가능.

## Warnings
- fee 관련 변수와 EV 계산 간 이중 차감 문제로 인해 진입 후보가 과도하게 차단될 수 있으니 반드시 확인 필요.
- 환경변수에 의존하는 파라미터가 많아, 변경 시 전체 전략 동작에 미치는 영향이 크므로 신중한 테스트 권장.
- 메모리 및 GPU 캐시 관리가 미흡하면 장기 운용 시 성능 저하 및 메모리 부족 문제 발생 가능.
- 레짐별 파라미터가 복잡하게 얽혀 있어, 단일 변수 변경이 의도치 않은 리스크 증가를 초래할 수 있음.


---
*Auto-generated by research/openai_reviewer.py*