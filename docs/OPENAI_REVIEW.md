# OpenAI Code Review — 2026-02-18 04:20

**Model:** gpt-4.1-mini
**Risk Score:** 7/10
**Summary:** 전략 코드는 레짐별 적응형 정책과 하이브리드 MC 시뮬레이션 기반 진입/청산 로직을 통합하여 높은 정밀도와 유연성을 갖추었으나, 일부 파라미터 이중 차감 문제와 레버리지 과다 설정, 복잡한 감쇠 체인에 따른 신호 약화 우려가 존재합니다.

## Suggestions

### [P1] net_expectancy 필터의 수수료 이중 차감 문제 해결
**Category:** logic | **Confidence:** 95%

evaluate_entry_metrics에서 MC EV는 이미 수수료가 차감된 값임에도 불구하고, _min_filter_states() 등에서 net_edge 계산 시 다시 수수료를 차감하여 신호가 과도하게 약화되고 있습니다. 이중 차감으로 인해 진입 필터가 불필요하게 엄격해질 수 있으므로, net_expectancy 계산 시 수수료 차감 부분을 제거하거나 MC EV에서 수수료를 역산해 보정하는 로직을 추가해야 합니다.

**Env Changes:** `{'ENTRY_NET_EXPECTANCY_MIN': '-0.0008'}`

**Code Changes:** engines/mc/entry_evaluation.py 내부 net_expectancy 계산 부분에서 fee_est 차감 제거 또는 보정 로직 추가 필요. 관련 주석 및 문서화도 함께 수정.

**Expected Impact:** 진입 신호의 왜곡 감소 및 필터 통과율 개선으로 전체 진입 기회 증가와 수익성 향상 기대.

### [P1] 레버리지 상한값 현실적 조정 및 동적 제한 강화
**Category:** risk | **Confidence:** 90%

현재 bybit.env에서 MAX_LEVERAGE=15, UNI_LEV_MAX=50 등 매우 높은 레버리지 한도를 설정하고 있으나, 과거 청산 손실 사례가 존재합니다. 레짐별 최대 레버리지(예: bull=20, chop=6 등)를 엄격히 적용하고, 고변동 레짐에서는 레버리지 제한을 더욱 강화하는 동적 제한 로직을 추가하여 리스크를 줄여야 합니다.

**Env Changes:** `{'MAX_LEVERAGE': '15', 'UNI_LEV_MAX': '20', 'UNI_LEV_MAX_CHOP': '6', 'UNI_LEV_MAX_VOLATILE': '4'}`

**Code Changes:** engines/mc/regime_policy.py 내 get_regime_policy 함수에서 레버리지 상한값을 레짐별 환경변수로 엄격 적용하고, MonteCarloDecisionMixin 결정 로직에서 max_leverage를 반드시 준수하도록 강화.

**Expected Impact:** 과도한 레버리지 진입 감소로 청산 리스크 완화 및 계좌 보호 효과 기대.

### [P2] VPIN 및 변동성 게이트 필터 파라미터 적용 및 모니터링 강화
**Category:** param | **Confidence:** 85%

CF 분석 결과 VPIN 필터(max_vpin=0.3)와 volatility_gate 필터(chop_min_sigma=0.35, chop_max_sigma=1.2 등)가 PnL 개선에 크게 기여하였으므로, 환경변수에 반영하고 실시간 모니터링을 강화해야 합니다. 특히 chop regime에서의 필터 임계치를 엄격히 적용하여 잡음성 진입을 줄여야 합니다.

**Env Changes:** `{'MAX_VPIN': '0.3', 'CHOP_MIN_SIGMA': '0.35', 'CHOP_MAX_SIGMA': '1.2', 'CHOP_MAX_VPIN': '0.65', 'CHOP_MIN_DIR_CONF': '0.6', 'CHOP_MIN_ABS_MU_ALPHA': '5.0', 'CHOP_MAX_HOLD_SEC': '180'}`

**Code Changes:** engines/mc/entry_evaluation.py 및 regime_policy.py에서 VPIN 및 변동성 게이트 필터 로직에 환경변수 적용 강화 및 로그 추가.

**Expected Impact:** 노이즈성 진입 감소 및 PnL 안정성 향상.

### [P2] 하이브리드 진입/청산 로직 내 방향 결정 정책 개선
**Category:** logic | **Confidence:** 80%

현재 HYBRID_DIRECTION_POLICY가 mu_consensus로 설정되어 있으나, 방향 결정 시 mu_alpha 부호 단독 결정과 혼용되어 혼란 가능성이 있습니다. 방향 결정 로직을 명확히 분리하고, 방향 모델(confidence, consensus) 기반 결정에 일관성 있게 맞추어야 하며, 방향 결정과 EV 계산 간 불일치 방지를 위한 검증 로직을 강화해야 합니다.

**Env Changes:** `{'HYBRID_DIRECTION_POLICY': 'mu_consensus', 'USE_DIRECTION_MODEL': '1'}`

**Code Changes:** engines/mc/decision.py 내 _decide_hybrid_only 함수에서 방향 결정 로직 정리 및 일관성 검증 강화.

**Expected Impact:** 방향 결정 오류 감소 및 신뢰도 높은 진입 판단으로 수익성 개선 기대.

### [P3] 메모리 누수 및 대형 배열 해제 로직 강화
**Category:** perf | **Confidence:** 75%

evaluate_entry_metrics 등에서 대형 텐서와 배열을 명시적으로 해제하고 가비지 컬렉션을 수행하고 있으나, 일부 예외 처리 및 캐시 클리어가 누락될 수 있습니다. 특히 GPU 메모리 캐시 정리 부분을 try-except로 감싸고 있으나, 실패 시 로그 기록 및 재시도 로직 추가가 필요합니다.

**Code Changes:** engines/mc/entry_evaluation.py 내 메모리 해제 및 캐시 정리 코드에 로깅 및 예외 재처리 로직 추가.

**Expected Impact:** 장기 운용 시 메모리 누수 방지 및 안정성 향상.

### [P3] CHOP regime 내 chop_guard 필터 임계치 조정
**Category:** param | **Confidence:** 80%

CF 결과 chop_guard 필터(chop_entry_floor_add=0.003, chop_entry_min_dir_conf=0.8)가 PnL 개선에 기여하였으므로, chop regime 진입 시 mu_alpha 절대값과 방향 신뢰도 임계치를 강화하여 잡음성 진입을 줄이고 신호 강도를 확보해야 합니다.

**Env Changes:** `{'CHOP_ENTRY_FLOOR_ADD': '0.003', 'CHOP_ENTRY_MIN_DIR_CONF': '0.8'}`

**Code Changes:** engines/mc/entry_evaluation.py 및 regime_policy.py에서 chop_guard 관련 파라미터 환경변수 반영 및 필터 로직 강화.

**Expected Impact:** chop regime 내 불필요한 진입 감소 및 수익성 향상.

## Warnings
- MC EV 계산 시 수수료가 이미 차감된 값임을 반드시 인지하고 추가 수수료 차감 로직을 점검할 것.
- 과도한 레버리지 설정은 청산 리스크를 급격히 증가시키므로, 반드시 레짐별 최대 레버리지 한도를 엄격히 적용할 것.
- 감쇠 체인이 복잡하여 mu_alpha 신호가 과도하게 약화될 수 있으므로, 신호 강도 및 필터 차단률을 지속 모니터링할 것.
- 하이브리드 진입/청산 로직과 방향 결정 모델 간 불일치가 발생하지 않도록 일관성 검증 로직을 강화할 것.
- 대규모 MC 시뮬레이션 후 메모리 해제 및 GPU 캐시 정리가 실패할 경우 시스템 불안정으로 이어질 수 있으니, 관련 예외 처리 및 로깅을 강화할 것.


---
*Auto-generated by research/openai_reviewer.py*