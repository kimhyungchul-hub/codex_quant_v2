# OpenAI Code Review — 2026-02-18 19:16

**Model:** gpt-5.2-codex
**Risk Score:** 7/10
**Summary:** 핵심 리스크는 EV/필터 단계에서의 수수료 이중 차감과 VPIN/volatility 필터 미적용으로 인한 저품질 진입입니다. 레버리지 기본값 및 seed 안정성도 실전 리스크를 키울 수 있어 보완이 필요합니다.

## Suggestions

### [P1] net_expectancy 필터의 수수료 이중 차감 제거
**Category:** logic | **Confidence:** 78%

문서에 명시된 대로 _min_filter_states()에서 edge_raw(이미 MC fee 포함)에서 fee_est를 다시 빼고 있어 EV가 과도하게 음수로 압축됩니다. fee_est를 0으로 두거나 edge_raw를 gross EV로 복원해 단일 차감만 유지해야 합니다. 수정 후 ENTRY_NET_EXPECTANCY_MIN을 0에 가깝게 정상화할 수 있습니다.

**Env Changes:** `{'ENTRY_NET_EXPECTANCY_MIN': '0.0'}`

**Code Changes:** main_engine/_min_filter_states 또는 해당 필터 함수에서 `net_edge = edge_raw - fee_est`를 `net_edge = edge_raw`로 변경하거나, edge_raw를 fee 이전 값으로 복원. MC가 이미 fee 반영하도록 유지.

**Expected Impact:** 불필요한 진입 차단 감소, EV 분포 왜곡 해소, 트레이드 수 증가와 PnL 개선

### [P1] CF 최적 VPIN/Volatility gate 반영 (all_regimes)
**Category:** param | **Confidence:** 66%

OOS CF에서 vpin_filter(max_vpin=0.3)와 volatility_gate(all_regimes, sigma 0.2~1.8, dir_conf 0.64, mu_alpha 5.0, hold 180s)가 유의미한 개선을 보였습니다. 현재 CHOP_VPIN_MAX=0.5로 모니터링 중이므로 0.3으로 강화하고, scope를 all_regimes로 확장하는 것이 합리적입니다.

**Env Changes:** `{'VOLATILITY_GATE_SCOPE': 'all_regimes', 'CHOP_VOL_GATE_MIN_SIGMA': '0.2', 'CHOP_VOL_GATE_MAX_SIGMA': '1.8', 'CHOP_VPIN_MAX': '0.3', 'CHOP_ENTRY_MIN_DIR_CONF': '0.64', 'CHOP_ENTRY_MIN_MU_ALPHA': '5.0', 'TARGET_HOLD_SEC_MAX_CHOP': '180'}`

**Code Changes:** volatility_gate 및 vpin_filter가 참조하는 env 키가 위 변수명을 그대로 사용하도록 확인. 미사용이면 해당 필터 로직에 env 연결 추가.

**Expected Impact:** 저품질/고유동성 진입 차단 → OOS 기준 +$270 수준의 PnL 개선 기대

### [P1] 결정 결과의 기본 optimal_leverage 상한 적용
**Category:** risk | **Confidence:** 73%

decision.py에서 meta에 레버리지가 없으면 `20.0`을 기본으로 주입해 MAX_LEVERAGE(15)를 무시할 수 있습니다. 특히 paper/training에서 과대 레버리지로 성과 왜곡 가능. ctx의 max_leverage 및 global cap으로 클램프 필요.

**Code Changes:** engines/mc/decision.py에서 `metric_copy['optimal_leverage'] = ... or 20.0` 부분을 `min(default, ctx_max_leverage)`로 수정. 예: `ctx_max = float(ctx.get('max_leverage', 15.0))` 후 `opt_lev = min(opt_lev, ctx_max)`.

**Expected Impact:** 레버리지 과대 적용 방지, 실거래/페이퍼 간 괴리 축소

### [P2] 결정 seed의 비결정성 해소 (Python hash 랜덤성 제거)
**Category:** logic | **Confidence:** 64%

`hash(symbol)`은 런타임마다 salt가 달라져 재현성과 모니터링이 불안정합니다. crc32/xxhash/sha1 등 안정 해시로 대체해 시뮬레이션 재현성을 높이세요.

**Code Changes:** engines/mc/decision.py의 `seed = int((hash(symbol) ^ seed_window) & 0xFFFFFFFF)`를 `seed = zlib.crc32(symbol.encode()) ^ seed_window` 등으로 대체.

**Expected Impact:** 결정 결과의 재현성 향상, 실험/백테스트 일관성 개선

### [P2] chop_guard 강화 (dir_conf 0.8, floor_add 0.003)
**Category:** param | **Confidence:** 58%

CF에서 chop_guard 강화가 OOS +$243 개선을 보였습니다. 최근 자동 적용에서 CHOP_ENTRY_MIN_DIR_CONF를 0.64까지 완화했으므로 신호 질 저하 가능성이 큽니다. chop 구간 손실이 크므로 guard 재강화를 권장합니다.

**Env Changes:** `{'CHOP_ENTRY_MIN_DIR_CONF': '0.8', 'CHOP_ENTRY_FLOOR_ADD': '0.003'}`

**Code Changes:** 엔트리 필터에서 CHOP_ENTRY_MIN_DIR_CONF, CHOP_ENTRY_FLOOR_ADD를 직접 읽는지 확인하고, 미사용 시 env 연결 추가.

**Expected Impact:** 횡보 구간 저품질 진입 감소, 손실 억제

## Warnings
- 필터 강화는 거래 수를 크게 감소시킬 수 있으므로 24~48시간 모니터링 및 롤백 플랜 필요
- 레버리지/홀드 관련 설정이 bybit.env에서 상충되는 값(UNI_LEV_MAX=50 vs MAX_LEVERAGE=15)을 포함하므로, 실제 캡 적용 여부를 반드시 로그로 검증할 것


---
*Auto-generated by research/openai_reviewer.py*