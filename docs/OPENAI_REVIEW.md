# OpenAI Code Review — 2026-02-18 22:53

**Model:** gpt-5.2-codex
**Risk Score:** 7/10
**Summary:** 핵심 로직은 하이브리드/MC 체계로 일관되어 있으나, 수수료 이중 차감·시드 비결정성·레버리지 캡 불일치와 같은 구조적 리스크가 남아 있습니다. CF 결과 기준으로 VPIN/변동성 게이트 적용을 강화하면 성과 개선 가능성이 큽니다.

## Suggestions

### [P1] net_expectancy 필터의 수수료 이중 차감 제거
**Category:** logic | **Confidence:** 74%

docs에서 언급된 대로 net_expectancy 계산 시 MC EV에 이미 포함된 fee를 다시 차감하는 구조가 있어 진입이 과도하게 차단될 수 있습니다. edge_raw가 이미 net EV라면 fee_est를 다시 빼지 않도록 수정하거나, fee_est를 0으로 고정하는 플래그를 도입하세요.

**Code Changes:** main_engine._min_filter_states() 또는 net_expectancy 계산부에서 `net_edge = edge_raw - fee_est` → `net_edge = edge_raw`로 수정. 또는 `ENTRY_NET_EXPECTANCY_FEE_MULT` 같은 플래그를 추가해 fee_est*0 적용.

**Expected Impact:** 불필요한 진입 차단 감소, EV가 0 근처인 구간에서 의사결정 왜곡 완화 → PnL/WR 개선 기대.

### [P1] MC 시드 결정 안정화 (Python hash 랜덤성 제거)
**Category:** logic | **Confidence:** 82%

decide()에서 seed = hash(symbol) 사용 시 프로세스 재시작마다 결과가 달라져 재현성이 깨집니다. 안정적인 해시(sha1/xxhash)로 고정하세요.

**Code Changes:** engines/mc/decision.py: `seed = int((hash(symbol) ^ seed_window) & 0xFFFFFFFF)` → `seed = int((stable_hash(symbol) ^ seed_window) & 0xFFFFFFFF)`로 변경. stable_hash는 hashlib.sha1(symbol.encode()).digest()[:4] 등으로 구현.

**Expected Impact:** 재현성 향상, 백테스트/실전 간 시뮬 결과 변동 감소, 디버깅 용이.

### [P1] VPIN 상한 필터 적용 (CF 최상위 개선안)
**Category:** param | **Confidence:** 65%

CF 결과에서 max_vpin=0.3이 가장 높은 개선 효과를 보였습니다. 현재 UNI_MAX_VPIN_HARD=0.95로 사실상 무제한이므로, 진입/레버리지 단계에서 VPIN 상한을 강하게 적용하세요.

**Env Changes:** `{'UNI_MAX_VPIN_HARD': '0.30'}`

**Code Changes:** 엔트리 필터에서 vpin > UNI_MAX_VPIN_HARD 시 can_enter=False 처리(이미 있다면 임계치만 변경). 레버리지 최적화에서도 고VPIN 구간에서 cap 강제 적용.

**Expected Impact:** 고VPIN(유동성 왜곡) 구간의 손실 거래 감소 → PnL +$276 수준의 개선 가능.

### [P1] 레버리지 상한 불일치 정합성 확보
**Category:** risk | **Confidence:** 60%

MAX_LEVERAGE=15와 UNI_LEV_MAX=50이 충돌합니다. 엔진이 UNI_LEV_MAX를 우선 사용하면 리스크 규정이 무력화될 수 있습니다. 하드 캡을 일치시키거나 `min(MAX_LEVERAGE, UNI_LEV_MAX)`로 강제하세요.

**Env Changes:** `{'UNI_LEV_MAX': '15', 'UNI_LEV_MAX_TREND': '15', 'UNI_LEV_MAX_CHOP': '10', 'UNI_LEV_MAX_VOLATILE': '8', 'UNI_LEV_MAX_BEAR': '12'}`

**Code Changes:** 레버리지 산출부에서 `cap = min(ctx.max_leverage, regime_policy.max_leverage, env_UNI_LEV_MAX)`로 통합. 하드 캡 미적용 경로(하이브리드/배치)도 동일 적용.

**Expected Impact:** 청산 위험 감소, tail-loss 축소. 변동성 급등 시 리스크 제어 강화.

### [P2] volatility_gate를 all_regimes로 확장 (CF 상위 개선안)
**Category:** param | **Confidence:** 63%

현재 VOLATILITY_GATE_SCOPE=chop_only로 제한되어 있으나 CF에서 all_regimes가 유의미하게 성과 개선을 보였습니다. chop에서도 sigma/vpin/dir_conf/mu_alpha 기준을 권장값으로 적용하세요.

**Env Changes:** `{'VOLATILITY_GATE_SCOPE': 'all_regimes', 'CHOP_VOL_GATE_MIN_SIGMA': '0.35', 'CHOP_VOL_GATE_MAX_SIGMA': '1.8', 'CHOP_VOL_GATE_MAX_VPIN': '0.65', 'CHOP_ENTRY_MIN_DIR_CONF': '0.80', 'CHOP_ENTRY_MIN_MU_ALPHA': '10.0', 'TARGET_HOLD_SEC_MAX_CHOP': '300'}`

**Code Changes:** volatility_gate 적용 스코프를 all_regimes로 확대하고, chop 기준치를 환경변수로 주입. 이미 모니터링 중이면 적용 상태를 로깅하여 충돌 여부 확인.

**Expected Impact:** 저품질 변동성 구간의 거래 억제 → OOS 기준 +$273 수준 개선 기대.

### [P2] 대용량 meta 벡터 저장 최소화 (메모리/속도 개선)
**Category:** perf | **Confidence:** 55%

entry_evaluation 결과 meta에 ev/cvar/horizon 벡터를 매번 저장해 메모리와 직렬화 비용이 큽니다. 로그/디버그 용도일 때만 저장하도록 플래그를 두세요.

**Env Changes:** `{'MC_STORE_DETAIL_VECTORS': '0'}`

**Code Changes:** engines/mc/entry_evaluation.py: meta에 ev_vector, cvar_vector, horizon_seq 등의 추가를 `if store_vectors:`로 감싸고 env 플래그로 제어.

**Expected Impact:** 배치 처리 latency 및 메모리 사용량 감소, GC 압박 완화.

## Warnings
- 레버리지/진입 필터 변경은 실거래 전 반드시 OOS 재검증 필요 (특히 UNI_LEV_MIN/UNI_LEV_MAX 조정).
- VPIN/변동성 게이트 강화는 거래 수를 크게 줄이므로, 포지션 수·수익 분산에 미치는 영향을 모니터링하세요.


---
*Auto-generated by research/openai_reviewer.py*