# OpenAI Code Review — 2026-02-18 04:28

**Model:** gpt-4.1-mini
**Risk Score:** 7/10
**Summary:** 전략 코드는 변동성 및 레짐 적응형 Monte Carlo 기반 진입/청산 의사결정 체계를 갖추었으나, 일부 비용 이중 차감, 레버리지 과다 설정, 복잡한 하이브리드 로직에 따른 성능 저하 우려가 존재합니다.

## Suggestions

### [P1] EV 계산 시 비용 이중 차감 문제 해결
**Category:** logic | **Confidence:** 95%

evaluate_entry_metrics 내부 및 _min_filter_states()에서 MC EV가 이미 수수료를 포함하는데, 추가로 수수료 비용을 다시 차감하는 구조로 인해 실제 기대수익이 과소평가되고 있음. 이중 차감 문제를 해결하기 위해 비용 차감 로직을 재검토하고, net_expectancy 필터에서 비용 차감 부분을 제거하거나 MC EV에서 비용을 역산해 보정할 필요가 있음.

**Code Changes:** engines/mc/entry_evaluation.py 및 engines/mc/decision.py 내 EV 및 비용 계산 부분 수정. evaluate_entry_metrics에서 비용 포함 여부 명확화, _min_filter_states()에서 비용 차감 제거 또는 보정 로직 추가.

**Expected Impact:** EV 산출 정확도 향상으로 불필요한 진입 차단 감소, 수익성 개선 및 필터링 신뢰도 증가.

### [P1] 과도한 최대 레버리지 제한 하향 조정
**Category:** risk | **Confidence:** 90%

현재 bybit.env에서 MAX_LEVERAGE가 50으로 설정되어 있는데, 이는 레짐별 권장 최대 레버리지(예: chop 6~8, bull 14~20 등)를 크게 초과하여 과도한 위험 노출 가능성이 있음. CF 분석 결과 및 과거 손실 사례를 반영해 최대 레버리지를 15~20 수준으로 제한하는 것이 안전함.

**Env Changes:** `{'MAX_LEVERAGE': '15'}`

**Code Changes:** 환경변수 및 engines/mc/config.py 내 기본 MAX_LEVERAGE 값을 15로 조정. 필요시 regime_policy.py의 레버리지 상한도 동기화.

**Expected Impact:** 과도한 청산 위험 감소, 포지션 손실 제한, 안정적 리스크 관리.

### [P2] 하이브리드 진입/청산 로직 및 방향 결정 파라미터 최적화
**Category:** param | **Confidence:** 85%

하이브리드 진입/청산 로직이 기본 True로 설정되어 있으나, 복잡한 beam search 및 LSM 기반 시뮬레이션이 성능 병목을 유발할 수 있음. 또한 방향 결정에 사용되는 alpha_direction_strength, min_confidence, gate 값들이 CF 결과와 일부 불일치. 하이브리드 관련 파라미터를 CF 결과에 맞춰 조정하고, 필요시 하이브리드 모드와 전통 모드 간 전환 옵션을 명확히 하여 성능과 안정성 균형을 맞출 필요가 있음.

**Env Changes:** `{'MC_HYBRID_ONLY': '1', 'USE_DIRECTION_MODEL': '1', 'ALPHA_DIRECTION_STRENGTH': '0.6', 'ALPHA_DIRECTION_MIN_CONFIDENCE': '0.65', 'ALPHA_DIRECTION_GATE_MIN_EDGE': '0.06', 'ALPHA_DIRECTION_GATE_MIN_SIDE_PROB': '0.6'}`

**Code Changes:** engines/mc/decision.py 내 하이브리드 관련 로직 및 방향 결정 필터 파라미터 조정. config.py 및 regime_policy.py 내 관련 파라미터 기본값 동기화.

**Expected Impact:** 방향 결정 정확도 향상, 불필요한 진입/청산 감소, 전체 전략 안정성 및 수익성 개선.

### [P2] 포지션 사이징 및 최대 노출 제한 강화
**Category:** risk | **Confidence:** 80%

현재 UNI_MAX_POS_FRAC 및 UNI_HARD_NOTIONAL_CAP 등 자본 집중 관련 파라미터가 다소 관대함. CF 결과에 따르면 고변동 환경에서 최대 6개 종목 집중투자가 효과적이므로, 최대 동시 활성 포지션 수 제한과 개별 포지션 자본 한도를 강화하여 과도한 집중 위험을 완화할 필요가 있음.

**Env Changes:** `{'CHOP_CAPITAL_FOCUS_MAX_ACTIVE': '6', 'UNI_MAX_POS_FRAC': '0.40', 'UNI_HARD_NOTIONAL_CAP': '1000.0'}`

**Code Changes:** regime_policy.py 및 config.py 내 포지션 사이징 관련 파라미터 기본값 조정 및 제한 로직 강화.

**Expected Impact:** 과도한 노출 방지, 리스크 분산, 변동성 환경에서 손실 제한 효과.

### [P3] 메모리 누수 및 불필요한 연산 최적화
**Category:** perf | **Confidence:** 75%

evaluate_entry_metrics 등에서 대용량 배열 및 텐서 해제와 가비지 컬렉션을 명시적으로 수행하고 있으나, 일부 예외 처리 누락과 중복 연산 가능성이 있음. GPU 가속 여부에 따른 분기 처리, 불필요한 로그 출력 최소화, 배치 처리 병렬화 개선 등을 통해 성능 최적화가 가능함.

**Code Changes:** engines/mc/entry_evaluation.py 내 메모리 해제 로직 보완, logging 레벨 조정, engines/mc/decision.py 내 배치 처리 최적화 및 GPU 가속 조건 명확화.

**Expected Impact:** 메모리 사용량 감소, 처리 속도 향상, 시스템 안정성 증가.

### [P3] None/NaN 처리 및 부호 규약 일관성 강화
**Category:** logic | **Confidence:** 80%

전략 내 여러 함수에서 None 또는 NaN 값이 발생할 수 있으며, 부호 규약(예: EV, mu_alpha, direction) 혼동 가능성이 존재함. _pick_ev_expected, _get_vector 등에서 예외 처리 강화 및 부호 일관성 검증 로직 추가가 필요함.

**Code Changes:** engines/mc/decision.py 및 entry_evaluation.py 내 데이터 정합성 검사 및 예외 처리 강화, 부호 규약 주석 추가 및 함수 내 검증 로직 보완.

**Expected Impact:** 예기치 않은 오류 감소, 신호 왜곡 방지, 안정적 의사결정 지원.

## Warnings
- MC EV 계산 시 비용이 중복 차감되어 실제 기대수익이 과소평가될 수 있으니 주의가 필요합니다.
- 최대 레버리지가 과도하게 높게 설정되어 있어 청산 위험이 커질 수 있습니다.
- 하이브리드 진입/청산 로직이 복잡하여 성능 저하 및 디버깅 난이도가 높습니다.
- 환경변수 및 config 파라미터가 다수 분산되어 있어 일관성 유지에 주의해야 합니다.
- None/NaN 값 처리 미흡으로 인한 예외 발생 가능성이 있으니 데이터 무결성 점검이 필요합니다.


---
*Auto-generated by research/openai_reviewer.py*