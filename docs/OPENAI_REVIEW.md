# OpenAI Code Review — 2026-02-18 21:43

**Model:** gpt-5.2-codex
**Risk Score:** 7/10
**Summary:** 전략은 하이브리드/유니파이드 구조로 정교하지만, 레버리지 상한 불일치·수수료 이중 차감·비결정적 시드 등 리스크/재현성 문제가 존재합니다.

## Suggestions

### [P1] 하이브리드/유니파이드 레버리지 상한 정합화 및 과대 노출 제한
**Category:** risk | **Confidence:** 72%

env에서 HYBRID_LEVERAGE=100, HYBRID_SIZE_FRAC=1.0, UNI_LEV_MAX=50 등이 MAX_LEVERAGE=15와 충돌합니다. 현재 hybrid-only가 기본이므로 실제 주문/페이퍼에서도 과도한 레버리지/노출 위험이 큽니다. 하드캡을 MAX_LEVERAGE 및 레짐 정책(max_leverage)와 일치시키고, hybrid의 size/노출 상한을 낮추는 것이 필요합니다.

**Env Changes:** `{'HYBRID_LEVERAGE': '15', 'HYBRID_SIZE_FRAC': '0.20', 'HYBRID_MAX_EXPOSURE': '7.0', 'UNI_LEV_MAX': '15', 'UNI_LEV_MAX_TREND': '15', 'UNI_LEV_MAX_CHOP': '12', 'UNI_LEV_MAX_BEAR': '10', 'UNI_LEV_MAX_VOLATILE': '8'}`

**Code Changes:** engines/mc/decision.py: optimal_leverage 산출 직후 `optimal_leverage = min(optimal_leverage, ctx.get('max_leverage', MAX_LEVERAGE), regime_policy.max_leverage)`로 하드 클립 추가. hybrid planner 결과가 meta에 설정되더라도 동일한 상한 적용.

**Expected Impact:** 리스크 폭주·청산 위험 감소, 레버리지 정책 일관성 확보.

### [P1] 시드 생성의 비결정성 제거 (Python hash 랜덤성 문제)
**Category:** logic | **Confidence:** 78%

현재 seed = hash(symbol) ^ seed_window 사용으로 프로세스마다 결과가 달라집니다(파이썬 해시 랜덤). 백테스트/재현성 및 디버깅이 어렵습니다.

**Code Changes:** engines/mc/decision.py: `seed = int((hash(symbol) ^ seed_window) & 0xFFFFFFFF)`를 `import hashlib` 후 `seed = int(hashlib.md5(symbol.encode()).hexdigest()[:8],16) ^ seed_window`로 교체.

**Expected Impact:** 결정 재현성 향상, 동일 입력에서 동일 결과 보장.

### [P1] net_expectancy 필터의 수수료 이중 차감 제거
**Category:** logic | **Confidence:** 67%

문서에 명시된 바와 같이 entry 필터에서 `edge_raw - fee_est`가 적용되며, edge_raw는 이미 MC EV(수수료 포함)입니다. 이중 차감은 진입 과차단을 유발합니다.

**Code Changes:** (필터 로직 파일: main_engine or entry_evaluation filter 영역) `net_edge = edge_raw - fee_est` 를 `net_edge = edge_raw`로 수정하거나 `edge_raw + fee_est`로 보정. 필요 시 fee_est를 0으로 설정하는 우회 옵션 추가.

**Expected Impact:** EV/score가 불필요하게 음수화되는 현상 완화, 유효 기회 회복.

### [P1] VPIN 필터 상향 적용 (CF 권고값 반영)
**Category:** param | **Confidence:** 63%

CF 분석에서 max_vpin=0.3가 OOS PnL 개선을 보였습니다. 현재 CHOP_VPIN_MAX=0.65로 느슨해 고위험 체결을 허용합니다.

**Env Changes:** `{'CHOP_VPIN_MAX': '0.30', 'UNI_MAX_VPIN_HARD': '0.65'}`

**Code Changes:** VPIN 필터가 적용되는 엔트리 게이트(예: entry_evaluation or min_filter_states)에서 CHOP_VPIN_MAX 및 UNI_MAX_VPIN_HARD를 참조하도록 확인/정합화.

**Expected Impact:** 고 VPIN 구간 거래 감소 → 손실 감소, OOS 성능 개선 기대.

### [P2] chop_guard/volatility_gate CF 권고값 고정
**Category:** param | **Confidence:** 58%

최근 자동 적용 이력에서 CHOP_ENTRY_MIN_DIR_CONF 값이 0.8 ↔ 0.68 사이로 변동 중입니다. CF 권고는 0.68 및 CHOP_ENTRY_FLOOR_ADD=0.003입니다. 변동은 신호 일관성을 해칩니다.

**Env Changes:** `{'CHOP_ENTRY_MIN_DIR_CONF': '0.68', 'CHOP_ENTRY_FLOOR_ADD': '0.003', 'TARGET_HOLD_SEC_MAX_CHOP': '900'}`

**Code Changes:** regime_policy.py와 entry filters에서 chop regime 설정이 해당 env 값을 우선 사용하도록 확인. (이미 적용되어 있다면 모니터링/고정으로 변경)

**Expected Impact:** chop 영역 과잉 필터링 완화 및 OOS 성능 안정화.

### [P2] 레짐 변동성 스케일과 entry threshold 정합성 보정
**Category:** logic | **Confidence:** 46%

compute_adaptive_objective에서 score를 vol_norm으로 축소하지만 entry_floor/threshold는 고정값이라 고변동 시 과도한 차단이 발생할 수 있습니다. 스코어 스케일과 threshold를 동일한 기준으로 맞추는 것이 안전합니다.

**Code Changes:** engines/mc/regime_policy.py: `entry_floor`, `score_entry_threshold`, `score_entry_floor`에 vol_scale 또는 1/vol_norm 스케일 적용 옵션 추가(예: `entry_floor *= vol_scale`). 상수값 보호를 위해 상한/하한 clamp 적용.

**Expected Impact:** 변동성 레짐에서 유효 신호의 과차단 감소, 레짐 간 공정한 기준 유지.

## Warnings
- 현재 HYBRID_LEVERAGE=100, HYBRID_SIZE_FRAC=1.0 설정은 MAX_LEVERAGE=15와 불일치하며, 실제 주문/페이퍼 모두에 과대 리스크를 유발할 수 있습니다.
- Python hash 기반 시드 사용은 프로세스마다 결과가 달라져 백테스트/디버깅 일관성을 해칩니다.


---
*Auto-generated by research/openai_reviewer.py*