# OpenAI Code Review — 2026-02-18 04:04

**Model:** gpt-4.1-mini
**Risk Score:** 7/10
**Summary:** 전략 코드는 MC 기반 진입/청산 의사결정과 레짐별 정책을 통합한 하이브리드 시스템으로, 방향 결정과 EV 산출에 다중 필터와 적응형 파라미터를 활용하지만, 일부 비용 이중 차감, 레버리지 상한 과다, 그리고 복잡한 감쇠 체인으로 인한 신호 약화 위험이 존재합니다.

## Suggestions

### [P1] EV 계산 시 비용 이중 차감 문제 해결
**Category:** logic | **Confidence:** 95%

evaluate_entry_metrics()에서 MC 시뮬레이션 결과 ev_raw(또는 ev)는 이미 수수료 및 슬리피지가 반영된 값임에도, _min_filter_states() 등 하류 필터에서 다시 수수료(fee_est)를 차감하여 net_edge를 계산함으로써 비용이 두 번 반영되는 문제가 있음. 이는 진입 필터가 과도하게 보수적으로 작동하여 유효 진입 기회를 놓칠 위험이 크므로, 비용 차감 로직을 정리하여 MC EV와 하류 필터 비용 차감 중복을 제거해야 함.

**Env Changes:** `{'ENTRY_NET_EXPECTANCY_MIN': '-0.0008'}`

**Code Changes:** evaluate_entry_metrics() 내부 ev 계산부에서 비용 포함 여부 명확화 및 _min_filter_states() 등 필터에서 비용 차감 부분을 주석 처리하거나 비용 0 처리. 또는 MC EV에서 비용을 역산해 보정하는 로직 추가.

**Expected Impact:** 비용 이중 차감으로 인한 진입 과도 차단 완화, 진입 기회 증가 및 수익성 개선 기대.

### [P1] 레버리지 상한 및 최소값 재조정
**Category:** param | **Confidence:** 90%

현재 bybit.env에서 UNI_LEV_MIN=10.0, UNI_LEV_MAX=50 등 매우 높은 레버리지를 허용하고 있음. CF 분석 결과 2~10 구간이 최대 손실 구간으로 나타나고, 과도한 레버리지는 큰 손실 위험을 내포함. 따라서 레버리지 상한을 레짐별 권장값(예: bull 20, chop 3~6, bear 10~12)으로 낮추고, 최소값도 1~3 수준으로 완화하는 것이 안전함.

**Env Changes:** `{'UNI_LEV_MIN': '1.0', 'UNI_LEV_MAX': '20.0', 'UNI_LEV_MAX_CHOP': '6.0', 'UNI_LEV_MAX_BEAR': '12.0', 'UNI_LEV_MAX_VOLATILE': '4.0'}`

**Code Changes:** config.py 및 regime_policy.py 내 레버리지 관련 기본값 및 env 변수 기본값 조정.

**Expected Impact:** 과도한 레버리지로 인한 급격한 손실 위험 감소, 안정적 포지션 관리 가능.

### [P2] 포지션 사이징 및 자본 집중 제한 강화
**Category:** risk | **Confidence:** 80%

현재 UNI_MAX_POS_FRAC=0.55, UNI_HARD_NOTIONAL_CAP=1600 등으로 자본 집중도가 높음. CF 결과 고변동 6개 집중 투자 전략은 수익성 개선에 기여하지만, 동시에 리스크 집중 가능성 존재. 포지션당 최대 노션(cap)과 전체 노출 한도를 엄격히 관리하고, CHOP_CAPITAL_FOCUS_MAX_ACTIVE 등 활성 종목 수 제한을 엄격히 적용할 필요가 있음.

**Env Changes:** `{'UNI_MAX_POS_FRAC': '0.40', 'UNI_HARD_NOTIONAL_CAP': '1000.0', 'CHOP_CAPITAL_FOCUS_MAX_ACTIVE': '6'}`

**Code Changes:** regime_policy.py 및 config.py 내 자본 배분 관련 기본값 조정 및 필터 강화.

**Expected Impact:** 과도한 자본 집중에 따른 급격한 손실 위험 완화, 포트폴리오 안정성 향상.

### [P2] 하이브리드 진입/청산 로직의 방향 결정 일관성 검증 및 개선
**Category:** logic | **Confidence:** 85%

현재 hybrid_only 모드에서 방향 결정이 mu_alpha 부호 단독이 아닌 exp_vals 비교로 이루어지며, direction_model과 consensus 점수를 함께 활용함. 다만, direction_model 사용 여부와 hybrid_direction_policy 설정에 따라 방향 결정 로직이 복잡해져 일관성 저하 가능성 존재. 방향 결정 로직을 명확히 문서화하고, fallback 경로 및 예외 처리를 강화할 필요가 있음.

**Env Changes:** `{'USE_DIRECTION_MODEL': '1', 'HYBRID_DIRECTION_POLICY': 'mu_consensus'}`

**Code Changes:** decision.py 내 _decide_hybrid_only() 및 direction 결정 관련 코드에 명확한 주석 추가 및 예외 처리 강화.

**Expected Impact:** 방향 결정 오류 감소, 신호 신뢰도 및 진입 정확도 향상.

### [P3] 메모리 누수 방지 및 GPU 캐시 정리 자동화 강화
**Category:** perf | **Confidence:** 70%

evaluate_entry_metrics() 등에서 대용량 텐서 및 배열 해제를 수동으로 수행하고 있으나, 예외 발생 시 누수가 발생할 수 있음. GPU(torch) 캐시 정리도 try-except로 감싸져 있어 실패 시 무시됨. 메모리 해제 로직을 별도 함수로 분리하고, 주기적 강제 가비지 컬렉션과 캐시 정리 호출을 자동화하여 안정성 강화 필요.

**Code Changes:** entry_evaluation.py 내 메모리 정리 코드를 함수화하고, 주기적 호출 스케줄러에 포함. GPU 캐시 정리 로직 강화 및 로그 추가.

**Expected Impact:** 장시간 운용 시 메모리 누수 및 GPU 메모리 부족 문제 감소, 시스템 안정성 향상.

### [P3] 입력 신호 감쇠 체인 및 필터 임계치 조정
**Category:** param | **Confidence:** 75%

docs/SIGNAL_PIPELINE_REFERENCE.md에 따르면 mu_alpha 신호가 과도하게 감쇠되어 chop_guard 등 필터에서 차단 빈도가 높음. HURST_RANDOM_DAMPEN, MU_MOM_SCALE, ALPHA_SCALING_FACTOR, CHOP_ENTRY_MIN_MU_ALPHA 등의 파라미터를 조정하여 신호 강도를 적절히 회복시키는 것이 필요함.

**Env Changes:** `{'HURST_RANDOM_DAMPEN': '0.85', 'MU_MOM_SCALE': '15.0', 'ALPHA_SCALING_FACTOR': '1.2', 'CHOP_ENTRY_MIN_MU_ALPHA': '0.3'}`

**Code Changes:** config.py 및 regime_policy.py 내 해당 파라미터 기본값 및 env 변수 조정.

**Expected Impact:** 진입 신호 강도 증가로 필터 통과율 상승, 진입 기회 확대 및 수익성 개선 기대.

## Warnings
- MC EV 계산 시 비용 이중 차감 문제로 인해 진입 필터가 과도하게 보수적으로 작동할 수 있음.
- 과도한 레버리지 허용은 큰 손실 위험을 내포하므로 반드시 제한 필요.
- 복잡한 하이브리드 방향 결정 로직은 예외 처리 및 일관성 검증이 필수적임.
- 메모리 및 GPU 캐시 관리가 미흡하면 장시간 운용 시 성능 저하 및 장애 발생 가능.
- 신호 감쇠 체인으로 인해 진입 신호가 약화되어 필터 차단 빈도가 높을 수 있음.


---
*Auto-generated by research/openai_reviewer.py*