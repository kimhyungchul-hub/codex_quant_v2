# OpenAI Code Review — 2026-02-18 04:58

**Model:** gpt-4.1-mini
**Risk Score:** 7/10
**Summary:** 전략 코드는 Monte Carlo 시뮬레이션 기반으로 진입/청산 및 레버리지 최적화를 수행하며, 레짐별 정책과 환경변수 기반 파라미터 조정을 통해 유연성을 확보하였으나, 일부 비용 이중 차감 문제와 레버리지 상한 설정, 필터 임계치 조정 필요성이 관찰됨.

## Suggestions

### [P1] EV 계산 시 비용 이중 차감 문제 해결
**Category:** logic | **Confidence:** 90%

evaluate_entry_metrics 내에서 MC 시뮬레이션 결과인 EV는 이미 수수료 및 비용이 반영되어 있음에도, net_expectancy 필터에서 추가로 비용을 차감하여 실제 기대수익이 과도하게 낮아지는 문제가 있음. 이로 인해 진입 차단이 과도해질 수 있으므로, 비용 차감 로직을 재검토하여 중복 차감 방지 필요.

**Env Changes:** `{'ENTRY_NET_EXPECTANCY_MIN': '-0.0008'}`

**Code Changes:** engines/mc/entry_evaluation.py 내 _min_filter_states() 함수에서 net_edge 계산 시 fee_est 차감 부분을 제거하거나, MC EV에서 비용을 역산하여 보정하는 로직 추가 필요.

**Expected Impact:** 진입 필터의 과도한 차단 완화로 신호 활용도 및 수익성 개선, false negative 진입 감소.

### [P1] 레짐별 레버리지 상한 및 최소값 환경변수 조정
**Category:** param | **Confidence:** 85%

현재 bybit.env에서 UNI_LEV_MIN=10.0, UNI_LEV_MAX=50 등 매우 공격적인 레버리지 설정이 존재함. CF 분석 결과 최대 레버리지 15 수준이 리스크 대비 적절하며, 과도한 레버리지는 청산 리스크를 증가시킴. 레짐별 max_leverage 값을 CF 결과에 맞춰 보수적으로 조정 권고.

**Env Changes:** `{'UNI_LEV_MAX': '15', 'MAX_LEVERAGE': '15', 'UNI_LEV_MIN': '1.0'}`

**Code Changes:** engines/mc/regime_policy.py 및 engines/mc/config.py 내 기본 및 env 변수로 설정된 레버리지 상한/하한 값을 조정.

**Expected Impact:** 청산 리스크 감소 및 안정적인 포지션 운영, 장기 수익성 향상.

### [P2] 포지션 사이징 및 노출 제한 강화
**Category:** risk | **Confidence:** 80%

현재 최대 포지션 비중(max_pos_frac)과 자본 집중 관련 파라미터가 공격적임. 특히 chop regime에서 max_pos_frac 0.55, max exposure 7.0 등은 변동성 높은 시장에서 과도한 위험 노출 가능. CF 결과 기반으로 chop regime max_pos_frac을 0.4 이하로 낮추고, 전체 자본 노출 제한을 강화할 필요가 있음.

**Env Changes:** `{'UNI_MAX_POS_FRAC_CHOP': '0.35', 'UNI_MAX_TOTAL_EXPOSURE': '5.0'}`

**Code Changes:** engines/mc/regime_policy.py 및 engines/mc/config.py 내 max_pos_frac 및 exposure 관련 기본값 조정.

**Expected Impact:** 과도한 위험 노출 완화, 변동성 장에서 손실 제한 및 안정성 향상.

### [P2] 방향 결정 로직 및 방향성 모델 활용 개선
**Category:** logic | **Confidence:** 75%

현재 방향 결정 시 mu_alpha 부호 단독 결정 대신 hybrid_only 모드에서 exp_vals 비교를 사용하나, USE_DIRECTION_MODEL 환경변수와 HYBRID_DIRECTION_POLICY 설정이 혼재되어 혼란 가능. 방향성 모델 사용 여부와 정책을 명확히 분리하고, 방향성 신뢰도(confidence) 기반 gating 강화 필요.

**Env Changes:** `{'USE_DIRECTION_MODEL': '1', 'HYBRID_DIRECTION_POLICY': 'consensus_only'}`

**Code Changes:** engines/mc/decision.py 내 방향 결정 관련 조건문 정리 및 config.py 내 방향성 모델 관련 파라미터 정비.

**Expected Impact:** 방향 결정 신뢰도 향상, 잘못된 방향 진입 감소 및 수익성 개선.

### [P3] 메모리 관리 및 불필요한 변수 해제 강화
**Category:** perf | **Confidence:** 70%

evaluate_entry_metrics 등에서 대용량 배열 및 텐서 사용 후 명시적 해제 및 gc.collect() 호출을 하고 있으나, 일부 예외 처리 구간에서 누락 가능성 존재. GPU 캐시 클리어 로직도 예외 처리 강화 필요. 전체적으로 메모리 릭 방지를 위해 try-except 범위 확대 및 주기적 메모리 상태 모니터링 권장.

**Code Changes:** engines/mc/entry_evaluation.py 내 메모리 해제 및 캐시 클리어 부분에 예외 처리 강화 및 로그 추가.

**Expected Impact:** 장시간 운용 시 메모리 누수 방지, 안정성 및 성능 유지.

### [P3] VPIN 및 변동성 게이트 필터 임계치 조정
**Category:** param | **Confidence:** 80%

CF 분석 결과 VPIN 필터(max_vpin=0.3) 및 volatility_gate 파라미터 조정이 수익성에 긍정적 영향을 미침. 현재 bybit.env 설정과 비교하여 max_vpin 및 chop_min_sigma, chop_max_sigma 등 필터 임계치를 CF 추천값에 맞춰 조정 권장.

**Env Changes:** `{'CHOP_VPIN_MAX': '0.3', 'VOLATILITY_GATE_SCOPE': 'all_regimes', 'CHOP_MIN_SIGMA': '0.5', 'CHOP_MAX_SIGMA': '1.8', 'CHOP_MAX_VPIN': '0.65', 'CHOP_MIN_DIR_CONF': '0.6', 'CHOP_MIN_ABS_MU_ALPHA': '10.0', 'CHOP_MAX_HOLD_SEC': '300'}`

**Code Changes:** bybit.env 및 config.py 내 관련 필터 파라미터 업데이트.

**Expected Impact:** 필터의 노이즈 감소 및 진입 품질 향상, 수익성 개선.

## Warnings
- MC EV 계산 시 비용이 이미 포함되어 있으므로 추가 비용 차감 시 신호가 과도하게 약화될 위험 있음.
- 과도한 레버리지 설정은 청산 리스크를 크게 증가시키므로 반드시 보수적 범위 내에서 관리할 것.
- 필터 임계치 변경 시 진입 차단률과 신호 강도 변화를 모니터링하여 과도한 진입 제한이나 과도한 진입 허용을 방지할 것.
- 메모리 해제 및 GPU 캐시 클리어 로직은 예외 상황에 대비하여 안정적으로 동작하는지 주기적으로 점검 필요.


---
*Auto-generated by research/openai_reviewer.py*