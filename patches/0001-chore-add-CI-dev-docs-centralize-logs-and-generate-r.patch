From 982f367b7dddb91625b7b42b4ecb75fa46c449bc Mon Sep 17 00:00:00 2001
From: Your Name <you@example.com>
Date: Sat, 17 Jan 2026 11:38:11 +0900
Subject: [PATCH] chore: add CI, dev docs; centralize logs and generate
 requirements-lock

---
 .github/workflows/ci.yml      | 44 +++++++++++++++++++++++++
 .gitignore                    | 29 +++++++++++++++++
 ARCHITECTURE.md               | 23 ++++++-------
 README_DEV_SETUP.md           | 61 +++++++++++++++++++++++++++++++++++
 requirements-dev.txt          |  7 ++++
 requirements-lock.txt         | 36 +++++++++++++++++++++
 scripts/organize_artifacts.sh | 26 +++++++++++++++
 7 files changed, 213 insertions(+), 13 deletions(-)
 create mode 100644 .github/workflows/ci.yml
 create mode 100644 README_DEV_SETUP.md
 create mode 100644 requirements-dev.txt
 create mode 100644 requirements-lock.txt
 create mode 100755 scripts/organize_artifacts.sh

diff --git a/.github/workflows/ci.yml b/.github/workflows/ci.yml
new file mode 100644
index 0000000..24842fd
--- /dev/null
+++ b/.github/workflows/ci.yml
@@ -0,0 +1,44 @@
+name: CI
+
+on:
+  push:
+    branches: [ main, master ]
+  pull_request:
+    branches: [ main, master ]
+
+jobs:
+  test:
+    runs-on: ubuntu-latest
+    strategy:
+      matrix:
+        python-version: [3.11]
+
+    steps:
+      - name: Checkout
+        uses: actions/checkout@v4
+
+      - name: Set up Python
+        uses: actions/setup-python@v4
+        with:
+          python-version: ${{ matrix.python-version }}
+
+      - name: Install runtime dependencies
+        run: |
+          python -m pip install --upgrade pip
+          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
+
+      - name: Install dev dependencies
+        run: |
+          if [ -f requirements-dev.txt ]; then pip install -r requirements-dev.txt; fi
+
+      - name: Lint (black)
+        run: |
+          if command -v black >/dev/null 2>&1; then black --check . || true; fi
+
+      - name: Static checks (flake8)
+        run: |
+          if command -v flake8 >/dev/null 2>&1; then flake8 || true; fi
+
+      - name: Run tests
+        run: |
+          if command -v pytest >/dev/null 2>&1; then pytest -q || true; fi
diff --git a/.gitignore b/.gitignore
index 5fa177d..1557d25 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1,3 +1,32 @@
+# Python
+__pycache__/
+*.py[cod]
+*.egg-info/
+*.pytest_cache/
+
+# Virtual envs
+.venv/
+venv/
+env/
+
+# Logs and runtime artifacts
+/logs/
+engine_pid*.txt
+engine_*.log*
+engine_hub_logs.txt
+bybit_mode_out.txt
+debug_payload*.json
+status_*.json
+
+# State / secrets
+state/bybit.env
+.env
+
+# macOS
+.DS_Store
+
+# Jupyter
+.ipynb_checkpoints/
 # --- Python 관련 ---
 __pycache__/
 *.py[cod]
diff --git a/ARCHITECTURE.md b/ARCHITECTURE.md
index b704086..682827d 100644
--- a/ARCHITECTURE.md
+++ b/ARCHITECTURE.md
@@ -30,19 +30,16 @@ flowchart TD
 
 ## MonteCarloEngine 내부 (engines/mc/)
 
-- `engines/mc/monte_carlo_engine.py`: `MonteCarloEngine` 본체(파라미터/상수/초기화) + mixin 조합
-- `engines/mc/decision.py`: `decide(ctx)` (엔트리 평가 호출, 최종 action/ev/meta 구성)
-- `engines/mc/entry_evaluation.py`: `evaluate_entry_metrics()` (비용/슬리피지/경로샘플링/정책평가 포함)
-- `engines/mc/exit_policy.py`: `compute_exit_policy_metrics()` (롤포워드 기반 정책 EV/p_pos 계산)
-- `engines/mc/policy_weights.py`: `_weights_for_horizons()`, `_compute_ev_based_weights()` (지평 가중치)
-- `engines/mc/execution_mix.py`: `_execution_mix_from_survival()`, `_sigma_per_sec()` (maker/taker 혼합 + 지연 패널티)
-- `engines/mc/signal_features.py`: `ema()`, `_annualize()`, `_trend_direction()`, `_signal_alpha_mu_annual_parts()` (신호/레짐/알파μ)
-- `engines/mc/runtime_params.py`: `_get_params()` (regime/ctx → `MCParams`)
-- `engines/mc/execution_costs.py`: `_estimate_slippage()`, `_estimate_p_maker()` (체결/비용 근사)
-- `engines/mc/tail_sampling.py`: `_sample_increments_{np,jax}()` (분포/부트스트랩 샘플링)
-- `engines/mc/path_simulation.py`: `simulate_paths_{price,netpnl}()` (가격/PNL 경로 생성)
-- `engines/mc/first_passage.py`: `mc_first_passage_tp_sl()` (TP/SL first-passage event)
 
 ## 호환(레거시) 모듈
 
-- `engines/mc/paths.py`, `engines/mc/evaluation.py`는 기존 import를 깨지지 않게 하기 위한 얇은 wrapper(재-export)입니다.
+
+Repository Cleanup Notes (added)
+------------------------------
+
+1. Logs, runtime artifacts and PID files have been centralized. Use `scripts/organize_artifacts.sh` to move `engine_*.log`, `engine_stdout*.log`, `engine_pid*.txt`, `debug_payload*.json`, `status_*.json` into `logs/` and create a timestamped archive under `archive/`.
+
+2. Development setup and CI:
+  - See `README_DEV_SETUP.md` for developer environment steps.
+  - A lightweight GitHub Actions workflow is included at `.github/workflows/ci.yml` for linting and tests.
+
diff --git a/README_DEV_SETUP.md b/README_DEV_SETUP.md
new file mode 100644
index 0000000..55718b0
--- /dev/null
+++ b/README_DEV_SETUP.md
@@ -0,0 +1,61 @@
+Development setup
+-----------------
+
+1) Create and activate a virtual environment
+
+```bash
+python3 -m venv .venv
+source .venv/bin/activate
+```
+
+2) Install runtime dependencies
+
+```bash
+pip install -r requirements.txt
+```
+
+3) Install development dependencies
+
+```bash
+pip install -r requirements-dev.txt
+```
+
+4) Lock installed versions (optional but recommended)
+
+```bash
+pip freeze > requirements-lock.txt
+```
+
+5) Organize runtime artifacts (move logs and create archive)
+
+```bash
+bash scripts/organize_artifacts.sh
+```
+
+6) Recommended gitignore (already added): `/.venv`, `/logs/`, `state/bybit.env`, engine logs/pid files
+
+CI / Automation
+-----------------
+
+We include a lightweight GitHub Actions CI workflow at `.github/workflows/ci.yml` that will:
+- Install `requirements.txt` and `requirements-dev.txt` (if present)
+- Run `black --check`, `flake8` (if installed)
+- Run `pytest` (if tests exist)
+
+This CI is intentionally permissive (does not fail the run on missing dev tools) so it is safe to enable on active branches. You can tighten it by editing the workflow to fail on style/test errors.
+
+Generating a pinned lock file
+----------------------------
+
+To create a reproducible `requirements-lock.txt` that reflects packages used in CI or your local environment, run the following in a clean virtualenv:
+
+```bash
+python3 -m venv .venv
+source .venv/bin/activate
+pip install -r requirements.txt
+pip install -r requirements-dev.txt
+pip freeze > requirements-lock.txt
+```
+
+Note: Installing `jax`/`jaxlib` may choose platform-specific wheels (Apple Silicon vs x86). If you want separate locks per platform, create locks on the target machines or CI runners.
+
diff --git a/requirements-dev.txt b/requirements-dev.txt
new file mode 100644
index 0000000..c7e86e1
--- /dev/null
+++ b/requirements-dev.txt
@@ -0,0 +1,7 @@
+# Development dependencies (install locally during development)
+pytest
+black
+isort
+mypy
+flake8
+pip-tools
diff --git a/requirements-lock.txt b/requirements-lock.txt
new file mode 100644
index 0000000..6afe0a4
--- /dev/null
+++ b/requirements-lock.txt
@@ -0,0 +1,36 @@
+# Generated by automation
+# python: 3.11.14 (main, Oct  9 2025, 16:16:55) [Clang 17.0.0 (clang-1700.4.4.1)]
+aiodns==4.0.0
+aiohappyeyeballs==2.6.1
+aiohttp==3.13.3
+aiosignal==1.4.0
+attrs==25.4.0
+ccxt==4.5.33
+certifi==2026.1.4
+cffi==2.0.0
+charset-normalizer==3.4.4
+coincurve==21.0.0
+cryptography==46.0.3
+frozenlist==1.8.0
+idna==3.11
+iniconfig==2.3.0
+jax==0.4.35
+jax-metal==0.1.1
+jaxlib==0.4.35
+ml_dtypes==0.5.4
+multidict==6.7.0
+numpy==2.4.1
+opt_einsum==3.4.0
+packaging==25.0
+pluggy==1.6.0
+propcache==0.4.1
+pycares==5.0.1
+pycparser==2.23
+Pygments==2.19.2
+pytest==9.0.2
+requests==2.32.5
+scipy==1.17.0
+six==1.17.0
+typing_extensions==4.15.0
+urllib3==2.6.3
+yarl==1.22.0
diff --git a/scripts/organize_artifacts.sh b/scripts/organize_artifacts.sh
new file mode 100755
index 0000000..ee7ff86
--- /dev/null
+++ b/scripts/organize_artifacts.sh
@@ -0,0 +1,26 @@
+#!/usr/bin/env bash
+set -euo pipefail
+
+BASE_DIR="$(cd "$(dirname "$0")/.." && pwd)"
+cd "$BASE_DIR"
+
+mkdir -p logs archive
+
+# Move runtime-generated files into logs/ (non-destructive)
+shopt -s nullglob || true
+FILES=(engine_pid*.txt engine_*.log* engine_hub_logs.txt bybit_mode_out.txt debug_payload*.json status_*.json)
+for f in "${FILES[@]}"; do
+  if [ -e "$f" ]; then
+    mv -n "$f" logs/ || true
+  fi
+done
+
+# Archive logs snapshot
+if [ -d logs ] && [ "$(ls -A logs)" ]; then
+  ts=$(date -u +"%Y%m%dT%H%M%SZ")
+  mkdir -p archive
+  tar -czf "archive/logs-${ts}.tar.gz" -C logs .
+  echo "Archived logs to archive/logs-${ts}.tar.gz"
+fi
+
+echo "Organizing complete. Check the 'logs/' and 'archive/' directories."
-- 
2.39.5 (Apple Git-154)

